<div class="track-list-collection-main" style="background-color: transparent; color: inherit;" #mainDiv *ngIf="songs">
  <div #headerDiv class="track-list-collection-header" *ngIf="injectHeaderDivSelector || injectHeaderElement"></div>
  <div #titleDiv class="track-list-collection-title row" *ngIf="songs && (title?.length > 0 || forceDisplayTitleDiv || injectTitleElementSelector || injectTitleElement)">
    <ng-template class="fade-in-half-sec" *ngIf="titleUseHtml; then htmlTitleElement else defaultTitleElement"></ng-template>
    <ng-template #defaultTitleElement>
      <h2 class="fade-in-1-sec center" style="margin-top: 50px;" *ngIf="title?.length > 0">{{title}}</h2>
    </ng-template>
    <ng-template #htmlTitleElement>
      <div [innerHTML]="title | safeHtml"></div>
    </ng-template>
  </div>
  <div #subtitleDiv class="track-list-collection-subtitle" *ngIf="injectSubtitleDivSelector || injectSubtitleElement"></div>
  <!-- Track list -->
  <div class="track-list-collection-content row" style="margin-bottom:0;" *ngIf="songs">
    <table class="bordered responsive-table white-text" *ngIf="songs?.length > 0">
      <thead #trackTableHead class="fade-in-half-sec">
        <tr>
          <th *ngIf="displayTrackNumber || (!disablePlayPauseBt)">{{trackNumberHeader}}</th>
          <th *ngIf="displaySongTitle">{{songTitleHeader}}</th>
          <th *ngIf="displayArtist">{{artistHeader}}</th>
          <th *ngIf="displayAlbum">{{albumHeader}}</th>
          <th *ngIf="displayYear">{{yearHeader}}</th>
          <th *ngIf="displayGenre">{{genreHeader}}</th>
          <th *ngIf="displayDuration">{{durationHeader}}</th>
          <th *ngIf="displaySaved">{{savedHeader}}</th>
          <th *ngIf="displayTimeAdded">{{timeAddedHeader}}</th>
          <th *ngIf="displayTimePlayed">{{timePlayedHeader}}</th>
          <th *ngIf="displayPlayCount">{{playCountHeader}}</th>
          <th *ngIf="displayPlayCountLastMonth">{{playCountLastMonthHeader}}</th>
        </tr>
      </thead>
      <tbody class="tracklist track-list-collection-list">
        <tr *ngFor="let song of (showAll || (songs?.length <= nRows)) ? songs : songs?.slice(0, nRows - 1); let i = index;"
          (dblclick)="disableDoubleClick ? absorbMouseEvent($event, i, true) : play(i)"
          (contextmenu)="disableContextMenu ? absorbMouseEvent($event, i, true) : songContextMenu.onContextMenu($event, song)"
          [ngClass]="{ 'playing': (displayPlaying && song.isPlaying) }"
        >
          <td class="song-number" *ngIf="displayTrackNumber || (!disablePlayPauseBt)">
            <!-- <div class="song-number-value" *ngIf="displayTrackNumber && song?.trackNumber">{{song?.trackNumber}}.</div> -->
            <!-- <div class="song-number-value" *ngIf="displayTrackNumber && (!song?.trackNumber)">{{i+1}}.</div> -->
            <div class="song-number-value" *ngIf="displayTrackNumber">{{i+1}}.</div>
            <a (click)="play($event, song)" class="song-playback-icon"  *ngIf="(!disablePlayPauseBt) && (!song.isPlaying)">
              <i class="material-icons" style=" font-size: 1.9rem; vertical-align: middle">play_circle_outline</i>
            </a>
            <a (click)="pause($event, song)" class="song-playback-icon" *ngIf="(!disablePlayPauseBt) && song.isPlaying">
              <i class="material-icons" style=" font-size: 1.9rem; vertical-align: middle">pause</i>
            </a>
          </td>
          <td *ngIf="displaySongTitle">
            {{song?.title}}
            <i *ngIf="displayExplicit && song.isExplicit" class="material-icons" style="margin-left: 20px; vertical-align: middle;">explicit</i>
          </td>
          <td *ngIf="song && displayArtist"><a [routerLink]="['detailedArtistPage(i)']" (contextmenu)="disableContextMenu ? absorbMouseEvent($event, i, true) : artistContextMenu.onContextMenu($event, { artistId: artistId(i), followed: false } )">{{artistName(i)}}</a></td>
          <td *ngIf="song && displayAlbum"><a [routerLink]="['detailedAlbumPage(i)']" (contextmenu)="disableContextMenu ? absorbMouseEvent($event, i, true) : albumContextMenu.onContextMenu($event, { albumId: albumId(i), followed: false } )">{{albumTitle(i)}}</a></td>
          <td *ngIf="displayYear">{{song?.year?.substring(0,4)}}</td>
          <!-- @TODO: Genre page <td *ngIf="displayGenre" [routerLink]="['detailedGenrePage(i)']">{{genreName(i)}}</td> -->
          <td *ngIf="displayGenre" >{{genreName(i)}}</td>
          <td *ngIf="displayDuration">
            <!-- NOTE: Putting these spans on separate lines creates a space for some reason. Though ugly, we should keep them on the same line -->
            <span *ngIf="song?.duration?.substring(0,3) != '00:'">{{song?.duration?.substring(0,3)}}</span><span *ngIf="song?.duration?.substring(3,4) != '0' || song?.duration?.substring(0,3) != '00:'">{{song?.duration?.substring(3,4)}}</span>{{song?.duration?.substring(4)}}
          </td>
          <td *ngIf="displaySaved">{{song?.saved}}</td>
          <td *ngIf="displayTimeAdded">{{song?.timeAdded | timeAgo}}</td>
          <td *ngIf="displayTimePlayed">{{song?.timePlayed | timeAgo}}</td>
          <td *ngIf="displayPlayCount">{{song?.playCount}}</td>
          <td *ngIf="displayPlayCountLastMonth">{{song?.playCountLastMonth}}</td>
        </tr>
        <tr class="fade-in-1-sec" *ngIf="!showAll && songs?.length > nRows">
          <td [attr.colspan]="columnCount()" style="text-align: center; font-weight: bold;">
            <a (click)="showAll = true">{{showAllBtText}}</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="col s12 fade-in-half-sec" style="margin-bottom: 40px;" @fade *ngIf="songs?.length == 0 && noEntitiesMessage?.length > 0">
    <div class="card-panel large transparent z-depth-0 center">
      <h3 class="grey-text">{{noEntitiesMessage}}</h3>
    </div>
  </div>
  <div #footerDiv class="track-list-collection-footer" *ngIf="injectFooterDivSelector || injectFooterElement"></div>

</div>

<div class="row fade-in-2-sec valign-wrapper" style="min-height: 250px;" *ngIf="loadingAnimation && (!songs)">
  <div class="loader fade-in-2-sec" @fade>Loading...</div>
</div>

<app-song-menu #songContextMenu [songs]="songs" [inPlaylist]="inPlaylist" [inMusic]="inMusic" [currentPlaylist]="currentPlaylist" [playlistOwner]="playlistOwner"></app-song-menu>
<app-artist-menu #artistContextMenu [artists]="artist" [library]="library"></app-artist-menu>
<app-album-menu #albumContextMenu [library]="library"></app-album-menu>
